function serialize(e){var t,n,r,i="",s="",o=0,u=function(e){var t=0,n=0,r=e.length,i="";for(n=0;n<r;n++){i=e.charCodeAt(n);i<128?t+=1:i<2048?t+=2:t+=3}return t},a=function(e){var t,n,r,i,s=typeof e;if(s==="object"&&!e)return"null";if(s==="object"){if(!e.constructor)return"object";r=e.constructor.toString();t=r.match(/(\w+)\(/);t&&(r=t[1].toLowerCase());i=["boolean","number","string","array"];for(n in i)if(r==i[n]){s=i[n];break}}return s},f=a(e);switch(f){case"function":t="";break;case"boolean":t="b:"+(e?"1":"0");break;case"number":t=(Math.round(e)==e?"i":"d")+":"+e;break;case"string":t="s:"+u(e)+':"'+e+'"';break;case"array":case"object":t="a";for(n in e)if(e.hasOwnProperty(n)){i=a(e[n]);if(i==="function")continue;r=n.match(/^[0-9]+$/)?parseInt(n,10):n;s+=this.serialize(r)+this.serialize(e[n]);o++}t+=":"+o+":{"+s+"}";break;case"undefined":break;default:t="N"}f!=="object"&&f!=="array"&&(t+=";");return t}(function(e,t,n,r){function s(t,n){t.config=e.extend({},i,n);t.sortables=t.find("ul");t.pages=t.find(".mashupPage");t.structure=t.find("#_trc_pages");t.removeItem=t.find(".removeItem");t.addItem=t.find(".addItem")}var i={};e.fn.trcMashupManager=function(t){function r(){var t=[];e.each(e("#trcMashupManager .mashupPage ul li"),function(n){t[n]=[];t[n].id=e(this).attr("data-id");e(this).find(".unboxed:checked").length>0&&(t[n].unboxed="yes");e(this).find(".notitle:checked").length>0&&(t[n].notitle="yes")});return t}function i(){var t=r();e("#_trc_pages").val(serialize(t))}function o(e){e.sortable({connectWith:".menuPage ul",forcePlaceholderSize:!0,placeholder:"placeholder",tolerance:"intersect",update:function(){i()}});e.disableSelection()}function u(){i()}function a(){e("#MashupManagerItems").prependTo("body")}new s(this,t);var n=this;a();o(n.sortables);n.removeItem.live("click",function(){e(this).parent("li:first").remove();u();return!1});e(".unboxed, .notitle").live("click",function(){u()});n.addItem.live("click",function(){e("#MashupManagerItems").reveal();return!1});e("#MashupManagerItems li").live("click",function(){var t=e(this).clone(),n=e(".mashupPage ul"),r=e(this).attr("data-template");t.appendTo(n);r==="default"&&t.append('<div class="checkboxes"><input type="checkbox" class="unboxed"> Unbox this page</div>');t.append('<div class="checkboxes"><input type="checkbox" class="notitle"> Remove This Page\'s Title</div>');e("#MashupManagerItems").trigger("reveal:close");u()})}})(jQuery,window,document);