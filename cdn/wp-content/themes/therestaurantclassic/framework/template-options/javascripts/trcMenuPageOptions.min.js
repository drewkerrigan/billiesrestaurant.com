function serialize(e){var t,n,r,i="",s="",o=0,u=function(e){var t=0,n=0,r=e.length,i="";for(n=0;n<r;n++){i=e.charCodeAt(n);i<128?t+=1:i<2048?t+=2:t+=3}return t},a=function(e){var t,n,r,i,s=typeof e;if(s==="object"&&!e)return"null";if(s==="object"){if(!e.constructor)return"object";r=e.constructor.toString();t=r.match(/(\w+)\(/);t&&(r=t[1].toLowerCase());i=["boolean","number","string","array"];for(n in i)if(r==i[n]){s=i[n];break}}return s},f=a(e);switch(f){case"function":t="";break;case"boolean":t="b:"+(e?"1":"0");break;case"number":t=(Math.round(e)==e?"i":"d")+":"+e;break;case"string":t="s:"+u(e)+':"'+e+'"';break;case"array":case"object":t="a";for(n in e)if(e.hasOwnProperty(n)){i=a(e[n]);if(i==="function")continue;r=n.match(/^[0-9]+$/)?parseInt(n,10):n;s+=this.serialize(r)+this.serialize(e[n]);o++}t+=":"+o+":{"+s+"}";break;case"undefined":break;default:t="N"}f!=="object"&&f!=="array"&&(t+=";");return t}(function(e,t,n,r){function s(t,n){t.config=e.extend({},i,n);t.sortables=t.find("ul");t.pages=t.find(".menuPage");t.structure=t.find("#_trc_menu");t.removeItem=t.find(".removeItem");t.removePage=t.find(".removePage");t.addPage=t.find(".addPage");t.addItem=t.find(".addItem")}var i={};e.fn.trcMenuManager=function(t){function r(){var t=[];e.each(e("#trcMenuManager").find(".menuPage"),function(n){t[n]=[];t[n].left=[];t[n].right=[];e.each(e(this).find(".menuLeft li"),function(){t[n].left.push(e(this).attr("data-id"))});e.each(e(this).find(".menuRight li"),function(){t[n].right.push(e(this).attr("data-id"))})});return t}function i(){var t=r();e("#_trc_menu").val(serialize(t))}function o(){e.each(e(".menuPage"),function(t){e(this).find("h1 .num").html(t+1);e(this).find(".addItem").attr("data-page",t+1);e(this).attr("data-page",t+1)})}function u(e){e.sortable({connectWith:".menuPage ul",forcePlaceholderSize:!0,placeholder:"placeholder",tolerance:"intersect",update:function(){i()}});e.disableSelection()}function a(){o();i()}function f(){e("#MenuManagerItems").prependTo("body")}new s(this,t);var n=this;f();u(n.sortables);n.removePage.on("click",function(){e(".menuPage").length==1?e(this).parents(".menuPage:first").find("ul").html(""):e(this).parents(".menuPage:first").remove();a();return!1});n.addPage.live("click",function(){var t=e(".menuPage:first").clone();t.find("ul").html("");t.insertAfter(".menuPage:last");u(t.find("ul"));a();return!1});n.removeItem.live("click",function(){e(this).parent("li:first").remove();a();return!1});n.addItem.live("click",function(){e("#MenuManagerItems").reveal();e("#MenuManagerItems").attr("data-page",e(this).attr("data-page"));e("#MenuManagerItems").attr("data-side",e(this).attr("data-side"));return!1});e("#MenuManagerItems li").live("click",function(){var t=e(this).clone(),n=e("#MenuManagerItems").attr("data-page"),r=e("#MenuManagerItems").attr("data-side"),i=e('.menuPage[data-page="'+n+'"]').find("."+r+" ul");t.appendTo(i);e("#MenuManagerItems").trigger("reveal:close");a()})}})(jQuery,window,document);